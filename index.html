<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Настройка Фильтров</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            padding: 20px;
            margin: 0;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            box-sizing: border-box;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .filter-group {
            padding: 15px;
            border: 1px solid var(--tg-theme-hint-color, #dddddd);
            border-radius: 8px;
            background-color: var(--tg-theme-secondary-bg-color, #f9f9f9);
        }
        .filter-group h2 {
            margin-top: 0;
            font-size: 18px;
            color: var(--tg-theme-text-color);
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        input[type="checkbox"] {
            margin-right: 8px;
            vertical-align: middle;
        }
        select, input[type="text"] {
            width: 100%; /* Убрал calc, т.к. box-sizing: border-box уже есть */
            padding: 10px;
            border: 1px solid var(--tg-theme-hint-color, #cccccc);
            border-radius: 5px;
            font-size: 16px;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            box-sizing: border-box; /* Важно для width: 100% */
        }
        #status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            display: none; /* Скрываем по умолчанию */
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error { /* Хотя здесь он не используется, но полезно иметь */
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div class="container">
        <h1>Настройка Фильтров</h1>

        <div class="filter-group">
            <h2>Основные фильтры</h2>
            <div>
                <input type="checkbox" id="notifications" name="notifications" checked>
                <label for="notifications" style="display: inline;">Включить уведомления</label>
            </div>
            <div>
                <input type="checkbox" id="showHidden" name="showHidden">
                <label for="showHidden" style="display: inline;">Показывать скрытые элементы</label>
            </div>
        </div>

        <div class="filter-group">
            <h2>Категория</h2>
            <label for="category">Выберите категорию:</label>
            <select id="category" name="category">
                <option value="all">Все категории</option>
                <option value="tech">Технологии</option>
                <option value="news" selected>Новости</option>
                <option value="sport">Спорт</option>
            </select>
        </div>

        <div class="filter-group">
            <h2>Ключевое слово</h2>
            <label for="keyword">Введите ключевое слово:</label>
            <input type="text" id="keyword" name="keyword" placeholder="Например, AI или blockchain">
        </div>

        <div id="status-message"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;

        tg.ready();
        tg.expand();

        const notificationsCheckbox = document.getElementById('notifications');
        const showHiddenCheckbox = document.getElementById('showHidden');
        const categorySelect = document.getElementById('category');
        const keywordInput = document.getElementById('keyword');
        const statusMessageDiv = document.getElementById('status-message');

        tg.MainButton.setText("Сохранить фильтры");
        tg.MainButton.color = tg.themeParams.button_color || "#007bff";
        tg.MainButton.textColor = tg.themeParams.button_text_color || "#ffffff";

        // Показываем и активируем кнопку сразу, так как есть дефолтные значения
        tg.MainButton.show();
        tg.MainButton.enable();


        function getFiltersData() {
            return {
                notifications_enabled: notificationsCheckbox.checked,
                show_hidden_elements: showHiddenCheckbox.checked,
                selected_category: categorySelect.value,
                search_keyword: keywordInput.value.trim()
            };
        }

        tg.MainButton.onClick(() => {
            // 1. Показать индикатор загрузки (опционально, если процесс быстрый)
            tg.MainButton.showProgress(false); // true для тонкого индикатора, false для перекрывающего
            tg.MainButton.disable(); // Отключаем кнопку на время "отправки"

            const filtersData = getFiltersData();

            console.log("Отправка данных:", JSON.stringify(filtersData)); // Для отладки в консоли браузера

            // 2. Отправляем данные боту
            tg.sendData(JSON.stringify(filtersData));

            // 3. Показываем сообщение об успехе в WebApp
            statusMessageDiv.textContent = "Фильтры отправлены!";
            statusMessageDiv.className = 'success'; // Сбрасить предыдущие классы и добавить success
            statusMessageDiv.style.display = 'block';

            // 4. Тактильный отклик
            tg.HapticFeedback.notificationOccurred('success');

            // 5. Скрыть индикатор прогресса и изменить состояние кнопки
            // Делаем это с небольшой задержкой, чтобы пользователь успел увидеть сообщение
            // и чтобы не было слишком резкого перехода.
            setTimeout(() => {
                tg.MainButton.hideProgress();
                // Можно изменить текст кнопки на "Сохранено" и оставить её неактивной
                // tg.MainButton.setText("Сохранено!");
                // tg.MainButton.disable(); // Она уже disable, можно оставить так
                // Или вернуть в исходное состояние, если пользователь может захотеть сохранить еще раз
                tg.MainButton.setText("Сохранить фильтры");
                tg.MainButton.enable(); // Снова активируем кнопку

                // Опционально: скрыть сообщение об успехе через некоторое время
                setTimeout(() => {
                    statusMessageDiv.style.display = 'none';
                }, 2000);


                // ВАЖНО: Если вы хотите, чтобы Web App закрылся после сохранения,
                // раскомментируйте следующую строку. Но убедитесь, что данные точно ушли боту.
                // Обычно лучше, чтобы бот подтвердил получение и потом, если нужно, Web App закрылся.
                // Либо пользователь сам закроет.
                // tg.close();
            }, 1000); // Задержка в 1 секунду (1000 мс)
        });

        console.log("Web App инициализировано. Версия SDK:", tg.version);
        console.log("InitDataUnsafe:", tg.initDataUnsafe); // Полезно для отладки

    </script>
</body>
</html>